sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/Sorter","sap/ui/core/message/Message","sap/m/MessageBox"],function(e,t,o,r,a,s,n,i){"use strict";return e.extend("StaffingApp.horvath.controller.BaseController",{formatter:o,getRouter:function(){return this.getOwnerComponent().getRouter()},getModel:function(e){return this.getView().getModel(e)},setModel:function(e,t){return this.getView().setModel(e,t)},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},onNavBack:function(){var e=t.getInstance().getPreviousHash();if(e!==undefined){history.go(-1)}else{this.getRouter().navTo("list",{},true)}},getCurrentPeriod:function(){var e=this.formatter.returnDataFormat("yyyyMM").format(new Date([(new Date).getFullYear(),(new Date).getMonth()+1,"01"].join("-"))),t=this.formatter.returnDataFormat("yyyyMM").format(new Date([(new Date).getFullYear(),(new Date).getMonth()+4,"01"].join("-")));return{nMinMth:+e,nMaxMth:+t}},getResourcePath:function(e,t){return[{oModel:this.getView().getModel(),sPath:"/WorkpackageSet",aFilters:[new r("ProjectID",a.EQ,e.EngagementProject)],oParams:{$select:"WorkPackageID,WorkPackageName"},aSort:[new s("WorkPackageID",false)]},{oModel:this.getView().getModel("EmployeeCapacity"),sPath:"/YY1_EMP_CAPACITY_API",aFilters:[new r("EngagementProject",a.EQ,e.EngagementProject)],aSort:[new s("PersonWorkAgreement",false),new s("YearMth",false)]},{oModel:this.getOwnerComponent().getModel("PROJ_ENGMT_UPDATE_SRV"),sPath:"/A_EngmntProjRsceSup",oParams:{$select:"WorkPackage,Version,Quantity,PersonWorkAgreement,to_ResourceSupplyDistribution,to_ResourceDemand",$expand:"to_ResourceSupplyDistribution,to_ResourceDemand,to_ResourceDemand/to_ResourceDemandDistribution"},aFilters:[new r("EngagementProject",a.EQ,e.EngagementProject)]},{oModel:this.getView().getModel("ProjectAssignmentDistr"),sPath:"/YY1_PROJ_ASSIGNMENT_DISTR",aFilters:[new r("Project",a.EQ,e.EngagementProject)],aSort:[new s("YearMth",false)]},{oModel:this.getView().getModel("TimeRecording"),sPath:"/YY1_TIME_RECORDING",aFilters:[new r("ProjectID",a.EQ,e.EngagementProject)],aSort:[new s("YearMth",false)]},{oModel:this.getView().getModel("EmpWriteOffPostpone"),sPath:"/YY1_EMP_WRITEOFF_POSTP_API",aFilters:[new r("ProjectID",a.EQ,e.EngagementProject)],aSort:[new s("YearMth",false)]}]},updateResource:function(e){e.oModel.update(e.sKey,e.oPayload,e.mParameters)},deleteResource:function(e){debugger;e.oModel.remove(e.sKey,"",e.mParameters)},fetchResources:function(e){return new Promise(function(t,o){e.oModel.read(e.sPath,{filters:e.aFilters,sorters:e.aSort,urlParameters:e.oParams,success:function(e,o){t(e)}.bind(this),error:function(e){o(e)}.bind(this)})})},batchChange:function(e){return new Promise(function(t,o){e.oModel.submitChanges(Object.assign(e.mParameters,{success:function(e,o){if(!!this.getModel("message")&&this.getModel("message").getData().some(e=>e.type==="Error")){i.error(this.getModel("message").getData().find(e=>e.type==="Error").message);sap.ui.getCore().getMessageManager().removeAllMessages();this.getModel("detailView").setProperty("/busy",false);return}t(e)}.bind(this),error:function(t){e.oModel.setUseBatch(false);e.oDetailModel.setProperty("/busy",false);o(t)}.bind(this)}))}.bind(this))},addMessageManager:function(e){var t=new n({message:e.message,type:e.type,target:"/messagePath",processor:null});sap.ui.getCore().getMessageManager().addMessages(t)}})});